name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-client:
    name: Build Client
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Use Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: client/package-lock.json
      - run: npm ci
        working-directory: ./client
      - run: npm run build
        working-directory: ./client

  build-server:
    name: Build Server
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Use Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: server/package-lock.json
      - run: npm ci
        working-directory: ./server
      # No build script for server, just checking install correctness

  build-services:
    name: Build Service
    runs-on: ubuntu-latest
    strategy:
      matrix:
        service: [alert-engine, price-updater, analytics-service, oracle-service, sentiment-service]
    steps:
      - uses: actions/checkout@v4
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.22'
      - name: Build ${{ matrix.service }}
        run: go build -v ./...
        working-directory: ./services/${{ matrix.service }}
